# RTS Decomposed

## основные механики и понятия

**Общие механики, присутствующие в большинстве существующих RTS, которые в любом случае надо реализовать.**

**Игровое пространство.** В любой игре есть пространство, в котором происходит действие. В нашей игре тоже есть ландшафт, по которому передвигаются юниты. К игровому пространству относится и туман войны.

**Ресурсы.** Основа экономической части игры. Различные ресурсы добываются или генерируются, накапливаются и расходуются по ходу развития. Принципиально отличающийся ресурс - время. Все остальные с помощью нескольких параметров можно причесать под одну гребенку.

**Юниты.** Интерактивные объекты игрового мира. На самом деле нет принципиальной разницы между зданием и юнитом, поэтому здания тоже можно отнести в эту категорию. Юниты и их возможности - это, пожалуй, одна из двух самых обширных механик, так как включает в себя множество подмеханик, таких как движение, строительство, смена состояний, бой и так далее. Я утверждаю, что есть сравнительно небольшой набор параметров и подмеханик с их собственными параметрами, такой, что этим набором можно функционально описать большинство юнитов и зданий в большинстве существующих стратегий.

**Исследование.** Вторая обширная механика, не столько по объему, сколько по сложности. Основная ее цель - создать пространство, в котором игрок мог бы выбирать и управлять вектором развития своих технологий, получая за это новые юниты, улучшения и здания. Исследования должны иметь достаточную вариативность, чтобы игра оставалась разной при повторных прохождениях, но при этом должня быть достаточно сбалансированы, чтобы не выдавать вундервафли через раз. Принципиальное требование к исследованиям в этой игре - это невозможность исследовать всё. То есть дерево исследований бесконечное. Естественно, это НЕ способ сохранять интерес к игре. Это способ заставить игрока делать то, что ему действительно нужно. Грубо говоря, если у тебя в некоторой игре есть город, и там только пять открытых домов, то игрок обшарит их все и скажет "а чо так мало". А если в городе тысяча открытых домов, и все разные, игрок обшарит 5, обшарит 10, а потом скажет "вот это ШВОБОДА!" и пойдет делать то, что ему реально интересно, потому что поймет, что все дома он все равно не обшарит. Короче, это способ исключить тупой перебор и заодно отвадить игрока от принципа двенадцати огурцов: "так, щас короче исследую все технологии, и максимальным стеком топовых юнитов набигу".

**"Уникальные" механики на будушее, которые встречаются в относительно малом количестве игр:**
Это, опять же, просто идеи. Это не то, что я буду делать прямо завтра.

**Сокрытие данных.** Игра про исследование и сюрпризы. В обычной стратегии ты точно знаешь все про свой юнит. В этой игре знания о своем юните надо заработать. Если ты только-только изобрел новый танк, будет неплохо обкатать небольшую партию и посмотреть на него в бою. Только дурак будет после первого опытного образца сразу заказывать сто штук и бросать их в бой. Еще раз: мой концепт - не старкрафт, он антистаркрафт, и это нормально.

**Шпионаж.** Выдача некоторых сведений о некоторых юнитах или действиях противника. Является заменой практике "знакомства" в шутерах, когда на тебя сначала набегает один монстр, чтобы ты с ним потренировался и понял его тактики и возможности, а потом уже на тебя бежит толпа. И является заменой многократного реплея в стратегиях. Поскольку у нас каждый раз разные юниты, то знание о том, что у противника только что появился новый юнит с какими-то параметрами может дать подсказку по поводу того, что надо сделать дальше. Естественно, это не обязательно - всегда есть ручной шпионаж, когда ты посылаешь условный трайк в место предполагаемого сбора войск, и узнаёшь, сколько там кого, кто там чем и насколько далеко стреляет. Расширение этой механики может быть (очень условно) следующим: убиваешь 5 "танков" - узнаешь подробно их статы. Убиваешь еще пять - получаешь бонус в исследовании связанной технологии. Убиваешь еще 10 - можешь производить такие же.


### Карта (территория)
На самом деле это достаточно сложный элемент. При первом рассмотрении он кажется элементарным - хуяк-хуяк, море-дерево-поле-куст, поехали. Но если копнуть глубже, возникают некоторые концептуальные вопросы, и надо уметь вовремя остановиться.

Начнем с того, игровое пространство можно разделить на два типа: ландшафт и зоны. Ландшафт - основная сущность пространства: в каждой точке есть какой-то ландшафт, и он только один. Ландшафт связан с физическим строением территории. Можно сказать, что ландшафт определяет меш того, на чем происходит игра. Область же является просто дополнением. Областей в данной точке может быть от нуля до бесконечности, это просто некоторое свойство пространства. В дюне ландшафт - это песок, камень и скалы. В they are billions это земля, вода и горы. Примеры областей - зона строительства в they are billions, поле пилонов или крип в старкрафте, тибериумные поля в c&c.


Некоторые важные свойства ландшафта и областей:

- Ландшафт не имеет свойств, он имеет типы, и на эти типы по разному реагируют разные юниты. Реакция на ландшафт - свойство юнита, не ландшафта.
- Области имеют эффекты, которые они накладывают на юнитов. Эффект области - свойство области, не юнита.
- Области могут пересекаться, каждая точка карты может принадлежать одновременно нескольким областям (залежи железной руды в химически зараженном поле)
- Ландшафт всегда имеет визуальное представление. Область может иметь визуальное представление (пшеничное поле), а может и не иметь (радиоактивное заражение)
- Области могут изменяться как по внутреннему содержанию (руда добывается, область становится беднее), так и по физическим размерам (крип ползет, заражение распространяется, лес вымирает)

С точки зрения данных область можно хранить как набор тайлов (руда в factorio занимает определенные координаты, и у каждой "рудинки" в координатах есть количество руды). В игре с непрерывным пространством это может быть геометрическая область или просто density map определенного фрагмента карты.

Сложность начинается, когда мы пытаемся провести границу и понять - "гора с залежами железа" в rimworld - это ландшафт или область? Исходя из здравого смысла - ландшафт. Но исходя из механик - это вообще юнит, потому что у него есть хитпоинты, ландшафт на такие мелочи не разменивается, а области слишком нематериальны, чтобы их можно было уничтожать.

В общем, к этому разделу надо будет еще раз вернуться после юнитов, особенно в контексте преодоления преград. Я пока не могу никак без костылей вписать в эту механику колоссов из второго старкрафта. 

### Ресурсы

Ресурсы - основа экономики. Есть уникальный ресурс - время. Он настолько отличается от остальных, что во всех упоминаниях идет особняком. Но все остальные живут примерно по одним и тем же правилам.


- Ресурсы делятся на два типа: исчерпаемые (руда, вода, загрязнение) и неисчерпаемые (солнечная энергия, вода в океане, мировой эфир, whatever). Добыча исчерпаемых ресурсов "переносит" их из одного места в другое, добыча неисчерпаемых ресурсов просто генерирует их "из ничего".
- Ресурсы также делятся еще на два типа: накапливаемые и ненакапливаемые. В they are billions накапливаемые - золото, ненакапливаемые - энергия или еда.
- Возможно, ресурсы делается еще на два типа: счетные и несчетные. Но тут я пока не могу придумать внятного примера применения. Вероятно, это можно заменить механикой областей.
- Исчерпаемый ресурс может быть свойствм области или юнита
- Есть общеигровое хранилище ресурсов

Дальше можно закопаться очень глубоко, уходя в дебри экономических и производственных стратегий, типа settlers или factorio - конвертация ресурсов, протухание ресурсов, множество складов, но в это мы пока углубляться не будем. Нам важно сделать примерный outline самого основного.

### Юниты

Довольно интересным осознанием для меня стало то, что между зданием и боевой единицей разницы по сути нет. Геймплейно разница по большей части выражается в том, что здание мы выставляем на карту *до* завершения постройки, а боевую единицу - *после*. В остальном они достаточно сильно смешиваются. Юнит ли разложенный осадный танк, или здание? Юнит ли летящий терранский командный центр? Юнит ли MCV до того, как его разложили? Или это просто construction yard в режиме грузовика?

- нет принципиальной разницы между зданием и боевой единицей
- каждый юнит _может_ реализовывать следующие базовые механики (и возможность реализации той или иной механики записана в его конфигурации)
	- взаимодействие с пользователем (мои могут, нейтральные не могут)
	- движение
	- производство
	- исследования
	- переключение режимов 
	- наложение эффектов при изменении состояния
	- бой

#### Режимы
По сути, режимы - это состояния юнита. Набор всех режимов - конечный автомат, между состояниями которого мы можем переключаться. Вероятно, постройка и гибель тоже являются состояниями этого автомата, и могут иметь связанные эффекты. Причем некоторые эффекты вполне могут переключать состояния.

- юнит может иметь несколько переключателей, и каждый переключатель может иметь несколько режимов (осадный режим танка, режим невидимости призрака)
- у каждого режима свой набор параметров. Фактически, юнит с двумя режимами - это два разных юнита. (копирование + изменение минимума параметров при процедурном создании нового режима, чтобы минимизировать разброс!)
- режимы могут переключаются независимо друг от друга, но некоторые режимы одного переключателя могут блокировать другие переключатели
- переход из одного режима в другой может требовать ресурсов (в том числе времени). Но может быть моментальный+бесплатный.
- процесс перехода из одного режима в другой может активировать эффекты.

_сложности - конфликты значений для параллельных режимов. вариант - запрещать изменять одни и те же значения разными переключателями_

#### Эффекты

Эффект - одна из самых важных механик, добавляющих гибкость. Эффект - это задача игровому движку на то, чтобы он в определенной области произвел определенные действия с параметрами определенных юнитов. Эффекты могут содержать эффекты, накладывать другие эффекты, и так далее. По сути эффект - это квант взаимодействия между юнитами. Пуля, летящая в цель, несет эффект "физический урон" количеством 25 тому, в кого попадет. Тибериумное поле несет эффект "химический урон" количеством 5 каждую секунду всем юнитам в радиусе 1 клетки от себя. Пси-шторм, ярость топора, невидимость арбитра - все это эффекты.


- Каждый юнит может создавать и накладывать любое количество эффектов, как в результате атаки, смены режима, смены состояния, так и просто без причины. Естественно, это все прописано в карточке юнита, это не означает, что каждый юнит каждый такт будет накладывать рандомный эффект на все вокруг.
- Каждый эффект с указанной вероятностью изменяет в указанных пределах указанные параметры юнитов, попадающих под его действие. Это в том числе позволяет реализовать сбор или генерацию ресурсов.
- Эффекты одного типа могут стекаться, если это указано в описании эффекта
- Эффекты могут быть одноразовыми (пуля в лоб) и протяженными во времени (кислотный ожог)
- Эффекты могут накладывать другие эффекты (если полить водой робота, то в течение 10 секунд он не будет получать никакого урона непосредственно от воды, но каждую секунду будет иметь возможность с вероятностью 1% получить эффект "короткое замыкание"). Пример надуманный, но он для демонстрации возможностей, а не потому что я правда собираюсь поливать роботов из брандспойта.

_здесь надо придумать такую структуру эффекта, чтобы она позволяла реализовать простейшие механики (сбор ресурсов, пара видов атаки), для самого первого PoC, но чтобы это не стало проблемой в будущем_

#### Бой
- Каждый юнит имеет _оружие_ (одно для каждого состояния? пока да)
- _оружие_ генерирует "выстрел"
	1. Выстрел - новый юнит (ракеты, мины, медленный плазменный дробовик, whatever). При коллизии срабатывают эффекты (которые, как правило, разрушает снаряд и наносят ущерб цели)
	2. Выстрел - непосредственное наложение эффекта сразу на цель или область (пси-шторм)
	3. Выстрел - линейный коллайдер (лазер, пулемет - пренебрегаем временем путешествия пули)
	4. ??? В данной схеме огнемет можно реализовать как либо создание "снаряда" огня, медленно летящего в конусе от огнемента, либо создание эффекта "поражение огнем" в конусовидной области перед юнитом.
- Выстрел воздействует согласно своему набору эффектов на область попадания
- Выстрел может иметь ограничение по движению (угол коллайдера к горизонту, дальность, для "ракет" - расстояние и высота). Этой механикой можно реализовать воздух-земля, земля-воздух и все такое. Здесь нужно подробнее посмотреть на total annihilation.
- Выстрел может стоить какого-то количества ресурсов, либо быть бесплатным. (время - тоже ресурс, эта механика реализует перезарядку)

_моментальные сложности - ограничение количества "выстрелов-юнитов". напрмиер, если "патрон" не уничтожается при попадании в цель, а остается на месте и генерирует вокруг себя ядовитое поле, причем у него самого к этому полю иммунитет. При высокой скорострельности я могу "засеять" всю карту такими патронами движок охуеет все считать.
Френдли файр может стать проблемой._

#### Производство
- по указанию юзера в очередь производства родительского юнита добавляется задача
- в момент начала выполнения задачи снимается определенная сумма всех необходимых ресурсов
- по выполнении этой задачи создается новый юнит

_Здесь надо подумать о том, какую действительно разницу имеют здание и машинка. Только ли во времени планирования?_

#### Исследование
* по указаню юзера в очередь исследования юнита добавляется указанное исследование
* исследование требует 

## Возможности

- Биологическая война
- Диверсия - уничтожение ресурсов
- Условный терраформинг (генератор леса, генератор гор)

## Вопросы
1) Юнит потребляет единицу хлеба в секунду. Хлеба нет. Что происходит?

